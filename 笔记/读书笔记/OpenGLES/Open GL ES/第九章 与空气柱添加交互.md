# 添加交互

良好的交互可以增加用户体验，那么我们可以加上交互。

- 首先为Activity添加一个碰撞事件，在Android中使用setOnTouchListener()监听视图，当用户触摸之后，就会由于一个onTouch事件。

  当用户触碰了那个视图之后，就会接收到一个onTouch();我们做的第一件事就是查看是否需要处理，在Android中，视图映射到左上角00，右下角等于视图的大小

  ```
  final float normalizedX = （event.getX()/(float)v.getWidth()）*-1;
  final float normalizedX = （event.getY()/(float)v.getHight()）*-1;
  ```

- 在Android中是-1到1之间，所以需要将其归一化之后，在进行操作。

  ```
  final float normalized = (X/width)*2-1  原因就是在中间为0,0点但是触摸屏是左上角，所以成2-1
  ```

- 转发触控事件给渲染器，在有触摸事件的时候，会执行渲染器中的方法，对绘制进行改变。

- 添加一个事件，然后对其进行使用线程操作。因为主线程中的UI在运行，所以为了渲染，需要在另一个线程中进行，使用queueEvent分发线程。

- 在Android中处理了某一个操作，就返回一个true，如果返回false或者是null,就表示未执行。

- 相交测试：我们已经检测到了触摸，但是这个使用事务触摸到了某个物体呢。下来就需要相交测试。

  将二维的转换为三维的，这个时候需要知道到底触摸到了什么，从触摸点做出一条射线。

  检测这个射线是否与物体相交【之前的触摸是，无论摸到什么都进行旋转等】

  **做法：**

  ​	使用一个变量存储是否将物体按住，

  ​	存储物体的位置。他给一个初始化值。

- 将触摸点与物体相交，将触摸投影到一条直线上，使用一个球装那个物体。

  （1）将**二维 点转为三维**的点，一个在近端一个在远端，我们画一条射线，将二维变为三维。

  二维到三维使用的是透视除法和透视投影。现在的做法就是将二维在三维里面相对应。也就是取消投影。

  （2）我们将触摸点放到一个直线上。所以需要一个反转矩阵。

  （3）将触碰的点变为一个射线

  ```
  private final float[] invertedViewProjectionMatrix = new float[16];
  在DrawFrame中，加入一行invert(pr,0,viewpro,0) 将二维转化为三维。
  invert（invertedViewProjectionMatrix,0,viewProjectMatrix,0）;
  上面的操作可以将一个二维的点转化到三维中，手指按下移动的是手指下那一小块的区域。
  ```

- 反转透视投影和透视投影

  **透视投影**

  为了将一个点映射到一条射线上，我们设置两个点，我们并不知道w为多大， 暂时认为是1,我们将每个点都乘以反转矩阵，得到最终的结果（空间坐标）。

  **透视除法**

  透视除法的作用就是创建一个合适的w值，那么我们把订单和视图投影矩阵相乘之后，nearPointWorld和farPointWorld实际上就含有了反转的w值。

  原因：投影矩阵主要的意义就是创建不同的w值，我们使用一个反转的投影矩阵，就会得到一个w值、

- 定义一个射线。我们求出近点和远点，就可以同两个点做出一个射线，

- 是否相交的检测:

  将目标变为一个球，通过比较射线和球之间的举例作为他们之间的距离。

  我们通过射线上的两个点，做出一个三角形，将他们的面积求出来，然后根据三角形面积公式，计算出距离。