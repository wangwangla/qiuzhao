# Lucene的索引文件格式

​	Lucene的索引中存储了什么，如何存放。Lucene索引创建的过程，就是按照全文检索的基本过程，将倒排表写成次文件格式的过程。速索就是将此文件格式将索引信息读取出来。

### 基本概念

------

一个索引过程，Lucene的所以结果是一个层次结构。分为索引、段、文档、域、词。

- 索引：在Lucene中一个索引是放在一个文件夹中的，同一个文件夹中的文件组成了一个索引。
- 段：一个索引可以包含多个段，段与段是独立的，添加新文件会生成新的端，不同的端可以合并，具有相同前缀的为一个段。segments.gen和segments_5是段的元数据，也就是保存了元数据。
- 文档是索引的基本单位，不同的文档是保存在不同的段中的，一个段包含多个文档。新增加的文件是一个新的段，但是段是可以合并的。
- 域：一篇文档包含不同类型的信息，可以分开索引；不同的域的处理方式不同。
- 词：词是索引的最小单位，是经过词法分析之后得到的。

Lucene索引中即保存了正向信息，也有反向信息

- 正向信息
  - 索引中---->端----->文档----->域----->词
  - 文件有：
    - segments_N：包含多少段，每个段有多少文档。
    - xx.fnm保存这个文档中有多少域。
    - xx.fdx  xxx.fdt:保存包含的所有文档，每个文档多少域，每个域多少词，每个词的字符串、位置信息。
- 反向信息
  - 词--->文档
  - 文件有：
    - xxx.tis:词典

## 数据类型：

---

Lucene索引文件中

- Byte:最基本的数据类型
- Uint32:由4个byte组成
- Uint64:有8个比byte组成
- VInt:长度变化的数据类型，可能包含多个byte的8位，前7位表示数值，最高1位表示还有另一个byte，0表示没有，1表示有。越在前面数值越低，越向后数值越高。
- Chars
- String

## 基本规则

- Lucene的反向索引中，要保存字典的信息，所有的词在词典中是按照字典顺序进行排列的，字典中包含了所有的词，将词公共的部分进行公用。
- 数字格式数据，将保存他们的差值，减少存储空间
- 某一个词 的后面跟一个词，他时通过判断后面的标志为，为0表示么有，1表示有。
- 跳跃表规则：
  - 元素有一下几个特性
    - 元素是排序的
    - 跳跃是有间隔的
    - 跳跃表示有间隔

## 具体格式

我们知道他们是有索引到段文档词的顺序，当然也存在一个反向的索引，词-->字段00文档