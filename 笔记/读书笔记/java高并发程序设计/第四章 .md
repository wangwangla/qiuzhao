## 锁优化和注意事项

锁是最常见的同步方法之一。锁竞争激烈的情况下会产生性能下降。

单任务，注意是自身任务花销，但是多线程而言，就需要保证数据一致性等问题，还有线程之间的切换，上下文之间的变化。但是并行计算一般低于串行，提供性能不是干的活少，而是更加充分使用CPU资源。

##### 锁的几点建议

- 减少持有所的时间
  - 执行的代码，直对需要同步的地方加锁，比如一个方法，里面有100条代码，加锁的之后一句，那么我们可以将方法锁变为代码块
- 减少锁的粒度
  - 减少锁的粒度，比如currentHashMap，我们不使用传统的锁方式，使用段，将一个大锁分成小的段处理。
- 读写分离
  - 读读不互斥，读写互斥， 写写互斥
- 锁分离
  - 
- 锁粗化